name: âª Rollback Version

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Docker Tag to rollback to (e.g., v1.0.0, dev-123, or commit sha)'
        required: true
        default: 'latest'

jobs:
  rollback:
    runs-on: [self-hosted, linux]  # ğŸ‘ˆ Báº¯t buá»™c pháº£i lÃ  self-hosted Ä‘á»ƒ cháº¡y trÃªn mÃ¡y báº¡n
    
    steps:
      - name: ğŸš€ Rollback Version
        run: |
          echo "Rolling back to version: ${{ inputs.tag }}"
          
          # 1. Login Docker (Ä‘á»ƒ pull private image)
          echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

          # 2. Pull image cÅ© vá»
          docker pull ${{ secrets.DOCKER_USERNAME }}/login-app:${{ inputs.tag }}
          
          # 3. Stop container hiá»‡n táº¡i
          docker stop login-app || true
          docker rm login-app || true
          
          # 4. Cháº¡y láº¡i container vá»›i tag cÅ©
          docker run -d \
            --name login-app \
            --restart unless-stopped \
            -p 3000:3000 \
            ${{ secrets.DOCKER_USERNAME }}/login-app:${{ inputs.tag }}
            
          echo "âœ… Rollback successful -> ${{ inputs.tag }}"
